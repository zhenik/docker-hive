---
- hosts: all
  become: yes
  tasks:
    - set_fact: acl_enabled="false"
      when: acl_enabled is undefined
    - debug: msg="ACL enabled {{ acl_enabled }}"
    - set_fact: mode="dev"
      when: mode is undefined

    - name: Enable ACL
      include_tasks: acl-enabled.yml
      when: acl_enabled == "true"

#    - name: "wait for nomad to come up"
#      uri:
#        url: "http://127.0.0.1:4646/v1/jobs"
#        status_code: 200
#      register: result
#      until: result.status == 200
#      retries: 60
#      delay: 3
#
#    - name: start minio nomad job
#      command: nomad job run /vagrant/test/minio-connect.hcl
#      register: fileoutput
#
#    - name: start hive nomad job
#      command: nomad job run /vagrant/test/hive-connect.hcl
#      register: fileoutput
#
#    - name: Test healthchecks of services
#      include_tasks: test.yml
#      # variable mode setup via extra_args in Vagrant.ansible_local or bash -> ANSIBLE_ARGS='--extra-vars "mode=test"' vagrant up --provision
#      when: mode == "test"